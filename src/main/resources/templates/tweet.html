<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
            crossorigin="anonymous"
    />
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
            integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
            crossorigin="anonymous"
    />
    <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <title>Real-Time Tweet Stream</title>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <form class="navbar-search pull-left">
            <div class="item">
                <img src="twitter-logo.png">
            </div>
            <input type="text" class="search-query" id="tweetSearch" placeholder="Search">
            <button type="submit" class="btn btn-primary" onclick="myFunction()">Search</button>
        </form>
        <a href="#" class="navbar-brand">Real-Time Tweet Stream</a>
    </div>
</nav>

<div class="container">
    <div id="tweetStream"></div>
</div>

<script
        src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
        integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
        crossorigin="anonymous"
></script>

<script>
    var stompClient;
    $(document).ready(function() {
        var socket = new SockJS('/live-tweet-stream');
        stompClient = Stomp.over(socket);

		stompClient.connect({}, function(frame) {
		stompClient.subscribe('/topic/tweets', function(tweets) {
		    console.log(tweets.body);
            const tweet = JSON.parse(tweets.body);
            const tweetData = {
            id: tweet.data.id,
            text: tweet.data.text
        }
        const tweetEl = document.createElement('div')
        tweetEl.className = 'card my-4'
        tweetEl.innerHTML = `
            <div class="card-body">
                <h5 class="card-title">${tweetData.text}</h5>
            </div>
        `

        tweetStream.appendChild(tweetEl)

		    });
		});
    });

    function streamTweets() {
    const request = new XMLHttpRequest();
    if ($('#tweetSearch').val() == '') {
        return false;
    }
    const url = 'localhost:8081/coopX/v1/streamTweets/produceDataStream?ruleFilter=' + $('#tweetSearch').val();;
    request.open("GET", url);
    request.send();
    }


</script>
</body>
</html>